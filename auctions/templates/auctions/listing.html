{% extends 'auctions/layout.html' %}

{% load crispy_forms_tags %}

{% block body %}
{% if whatched %}
  <a class="edit-btn" href="{% url 'whatch_del' listing.id %}">Remove from Whatchlist</a>
{% else %}
  <a class="edit-btn" href="{% url 'whatch_add' listing.id %}">Add to Whatchlist</a>
{% endif %}
<div class="active-listings mt-4">
  <div class="flex-container">
    <div class="list-item">
        <div class="items">
          <p><span class="field">Listing: {{listing.title}}</span><p>
          <p><span class="field">Category:</span> {{listing.category}}<p>
          <p><span class="field">Price:</span> ${{listing.start_price}}<p>
          <p><span class="date">Created {{listing.datetime|date:"M, d, Y, H:i"}}</span></p>
          <p><span class="field">Listed by:</span> {{listing.owner}}</p>
        </div>
    </div>
    {% if listing.image %}
    <img src="{{listing.image.url}}" alt="{{ listing.title }}">
    {% endif %}
    <div class="description">
      <div>{{listing.description}}</div>
    </div>
  </div> <!-- flex-container-->
  <div class="listing-form">
    {% if can_comment %}
    <form action="{% url 'add_comment' listing.id %}" method="post" 
        id="comment-form">
        {% csrf_token %}
        {{form|crispy}}
      <input class="btn btn-primary" type="submit" value="Submit">
    </form>
    {% endif %}
  </div>
  <div class="comments-container">
    {% for comment in listing.comments %}
      <p><span class="field">Comment ({{comment.by_user}}):</span> {{comment.comment}}</p>
    {% empty %}
      <h5>No comments yet</h5>
    {% endfor %}
  </div>
</div>
<p class="mt-3">
  <a class='menu' href="{% url 'index' %}">Back to Active Listings</a>
</p>

{% endblock %}